<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<link href="<%= GDPSID %>/css/index.css" rel="stylesheet" />
	<title>Редактор гаунтлетов | <%= GDPS %></title>
	<link rel="stylesheet" href="https://cdn.forever-gdps.host/engines/transitions.css" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="<%= GDPSID %>/js/render.js"></script>
	<noscript>Включите JavaScript в браузере для корректной работы сайта</noscript>
	<forcehead>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<script src="https://unpkg.com/swup@4"></script>
		<script src="https://unpkg.com/@swup/scripts-plugin@2"></script>
	</forcehead>
</head>
	
<body>
	<%- include("../../debugWindow") %>
	<main id="swup" class="transition-main">
		<style>
		body {
			text-align: center;
			display: block;
		}
		.level-input {
            margin: 10px;
            width: 65px;
        }
        @media screen and (min-width: 768px) {
            .level-input_container {
                margin-left: 250px;
                margin-right: 250px;
            }
        }
        @media screen and (max-width: 767px) {
            .stars-coins-input {
                width: 55px;
            }
        }
        .input-error {
            border-color: red;
            color: red;
        }
        .input-error:focus {
            color: red !important;
            border-color: red !important;
        }
        @media screen and (max-width: 767px) {
            .input-error {
                width: 55px;
                border-color: red;
                color: red;
            }
        }
	</style>
	<h1>Редактор гаунтлетов</h1>
	<% if (packData[1] != undefined || packData[1] != "") { %>
	<select disabled name="type">
		<option value="-1" disabled>Выберите гаунтлет</option>
		<optgroup label="2.1 гаунтлеты">
			<option value="1" <% if (packData[0] == 1) { %>selected <% } %>>Fire</option>
			<option value="2" <% if (packData[0] == 2) { %>selected <% } %>>Ice</option>
			<option value="3" <% if (packData[0] == 3) { %>selected <% } %>>Poison</option>
			<option value="4" <% if (packData[0] == 4) { %>selected <% } %>>Shadow</option>
			<option value="5" <% if (packData[0] == 5) { %>selected <% } %>>Lava</option>
			<option value="6" <% if (packData[0] == 6) { %>selected <% } %>>Bonus</option>
			<option value="7" <% if (packData[0] == 7) { %>selected <% } %>>Demon</option>
			<option value="8" <% if (packData[0] == 8) { %>selected <% } %>>Time</option>
			<option value="9" <% if (packData[0] == 9) { %>selected <% } %>>Crystal</option>
			<option value="10" <% if (packData[0] == 10) { %>selected <% } %>>Magic</option>
			<option value="11" <% if (packData[0] == 11) { %>selected <% } %>>Spike</option>
			<option value="12" <% if (packData[0] == 12) { %>selected <% } %>>Monster</option>
			<option value="13" <% if (packData[0] == 13) { %>selected <% } %>>Doom</option>
			<option value="14" <% if (packData[0] == 14) { %>selected <% } %>>Death</option>
		</optgroup>
		<optgroup label="2.2 гаунтлеты"></optgroup>
			<option value="15" <% if (packData[0] == 15) { %>selected <% } %>>Forest</option>
			<option value="16" <% if (packData[0] == 16) { %>selected <% } %>>Rune</option>
			<option value="17" <% if (packData[0] == 17) { %>selected <% } %>>Force</option>
			<option value="18" <% if (packData[0] == 18) { %>selected <% } %>>Spooky</option>
			<option value="19" <% if (packData[0] == 19) { %>selected <% } %>>Dragon</option>
			<option value="20" <% if (packData[0] == 20) { %>selected <% } %>>Water</option>
			<option value="21" <% if (packData[0] == 21) { %>selected <% } %>>Haunted</option>
			<option value="22" <% if (packData[0] == 22) { %>selected <% } %>>Acid</option>
			<option value="23" <% if (packData[0] == 23) { %>selected <% } %>>Witch</option>
			<option value="24" <% if (packData[0] == 24) { %>selected <% } %>>Power</option>
			<option value="25" <% if (packData[0] == 25) { %>selected<% } %>>Potion</option>
			<option value="26" <% if (packData[0] == 26) { %>selected<% } %>>Snake</option>
			<option value="27" <% if (packData[0] == 27) { %>selected<% } %>>Toxic</option>
			<option value="28" <% if (packData[0] == 28) { %>selected<% } %>>Halloween</option>
			<option value="29" <% if (packData[0] == 29) { %>selected<% } %>>Treasure</option>
			<option value="30" <% if (packData[0] == 30) { %>selected<% } %>>Ghost</option>
			<option value="31" <% if (packData[0] == 31) { %>selected<% } %>>Spider</option>
			<option value="32" <% if (packData[0] == 32) { %>selected<% } %>>Gem</option>
			<option value="33" <% if (packData[0] == 33) { %>selected<% } %>>Inferno</option>
			<option value="34" <% if (packData[0] == 34) { %>selected<% } %>>Portal</option>
			<option value="35" <% if (packData[0] == 35) { %>selected<% } %>>Strange</option>
			<option value="36" <% if (packData[0] == 36) { %>selected<% } %>>Fantasy</option>
			<option value="37" <% if (packData[0] == 37) { %>selected<% } %>>Christmas</option>
			<option value="38" <% if (packData[0] == 38) { %>selected<% } %>>Surprise</option>
			<option value="39" <% if (packData[0] == 39) { %>selected<% } %>>Mystery</option>
			<option value="40" <% if (packData[0] == 40) { %>selected<% } %>>Cursed</option>
			<option value="41" <% if (packData[0] == 41) { %>selected<% } %>>Cyborg</option>
			<option value="42" <% if (packData[0] == 42) { %>selected<% } %>>Castle</option>
			<option value="43" <% if (packData[0] == 43) { %>selected<% } %>>Grave</option>
			<option value="44" <% if (packData[0] == 44) { %>selected<% } %>>Temple</option>
			<option value="45" <% if (packData[0] == 45) { %>selected<% } %>>World</option>
			<option value="46" <% if (packData[0] == 46) { %>selected<% } %>>Galaxy</option>
			<option value="47" <% if (packData[0] == 47) { %>selected<% } %>>Universe</option>
			<option value="48" <% if (packData[0] == 48) { %>selected<% } %>>Discord</option>
			<option value="49" <% if (packData[0] == 49) { %>selected<% } %>>Split</option>
			<option value="50" <% if (packData[0] == 50) { %>selected<% } %>>NCS I</option>
			<option value="51" <% if (packData[0] == 51) { %>selected<% } %>>NCS II</option>
		</optgroup>
		<optgroup label="Пустые гаунтлеты">
			<option value="52" <% if (packData[0] == 52) { %>selected<% } %>>Unknown 1</option>
			<option value="53" <% if (packData[0] == 53) { %>selected<% } %>>Unknown 2</option>
			<option value="54" <% if (packData[0] == 54) { %>selected<% } %>>Unknown 3</option>
			<option value="55" <% if (packData[0] == 55) { %>selected<% } %>>Unknown 4</option>
			<option value="56" <% if (packData[0] > 55 || packData[0] < 1) { %>selected<% } %>>Unknown ?</option>
		</optgroup>
	</select>
	
	<div class="level-input_container">
		<p>* В 2.2 гаунтлеты не будут отображаться, если их меньше 4-х. Если у вас их меньше, создайте пустые гаунтлеты (в конце списка: Unknown 1/2/3/4) и введите несуществующие уровни для 2.200 - 2.206. Для 2.207 и выше - невозможные уровни.</p>
		<input type="number" name="level1" min="1" max="4294967296" class="level-input" value="<%= packData[1] %>" placeholder="Level 1">
		<input type="number" name="level2" min="1" max="4294967296" class="level-input" value="<%= packData[2] %>" placeholder="Level 2">
		<input type="number" name="level3" min="1" max="4294967296" class="level-input" value="<%= packData[3] %>" placeholder="Level 3">
		<input type="number" name="level4" min="1" max="4294967296" class="level-input" value="<%= packData[4] %>" placeholder="Level 4">
		<input type="number" name="level5" min="1" max="4294967296" class="level-input" value="<%= packData[5] %>" placeholder="Level 5">
	</div>
	<br><br>
	<button id="submit">Сохранить</button>
	<div id="gError"></div>
	<br><br>
	<button id="back">Назад</button>
	<% } else { %>
		<font color="ff0000" size="+2"><strong>Не удалось получить информацию о гаунтлете с ID <%= packData[1] %></strong></font>
	<% } %>
	</body>
	
	<script>
		$(document).ready(function() {
			$('#submit').click(function() {
				const TYPE = $('select[name="type"]').val();
				const LEVEL_1 = $('input[name="level1"]').val();
				const LEVEL_2 = $('input[name="level2"]').val();
				const LEVEL_3 = $('input[name="level3"]').val();
				const LEVEL_4 = $('input[name="level4"]').val();
				const LEVEL_5 = $('input[name="level5"]').val();

				const regex = /[-+\.e]/;
				const testInt = (variable) => {
    				return !regex.test(variable) && !isNaN(variable) && variable !== '';
				};

				// проверка, что все поля заполнены
				if (!LEVEL_1 || !LEVEL_2 || !LEVEL_3 || !LEVEL_4 || !LEVEL_5) {
    				$('#gError').html('<br><br><font color="red">Введите ID уровней</font>');
    				return;
				}

				// проверка, что все введённые значения - числа
				const levels = [LEVEL_1, LEVEL_2, LEVEL_3, LEVEL_4, LEVEL_5];
				for (let i = 0; i < levels.length; i++) {
    				const level = parseFloat(levels[i]);
    				if (isNaN(level) || !testInt(level)) {
        				$('#gError').html('<br><br><font color="red">Введите корректный ID уровней</font>');
        				return;
    				}
				}
				
				console.log(TYPE);
				if (TYPE == "-1" || TYPE == null) {
					$('#gError').html('<br><br><font color="red">Выберите название гаунтлета</font>');
					return;
				}

				$('#submit').prop('disabled', true);
				$('#back').prop('disabled', true);
				async function sendQuery(params) {
					const res = await sendPost('<%= GDPSID %>/panel/packs/gauntlets/edit', params);
					if (res == "1") {
						swup.navigate('<%= GDPSID %>/panel/packs/gauntlets');
						return;
					} else {
						$('#submit').prop('disabled', false);
						$('#back').prop('disabled', false);
						$('#gError').html(`<br><br><font color="red">Ошибка. Возможно, такой тип гаунтлета уже существует<br>Details: ${res}</font>`);
						return;
					}
				}

				const params = {
					ID: TYPE,
					level1: LEVEL_1,
					level2: LEVEL_2,
					level3: LEVEL_3,
					level4: LEVEL_4,
					level5: LEVEL_5
				}
				sendQuery(params);
			});

			$('#back').click(function() {
                $('#back').prop('disabled', true);
                swup.navigate('<%= GDPSID %>/panel/packs/gauntlets');
                $('#back').prop('disabled', false);
            });
		});
	</script>
	</main>
<script>
	var swup = new Swup ({
		containers: ["#swup", "forcehead"], 
		linkSelector: 'a[soft]', 
		cache: false, 
		plugins: [
			new SwupScriptsPlugin()
		]
	});
	</script>
</body>
</html>